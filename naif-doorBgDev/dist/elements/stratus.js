let wisW,doorContent,stratusCircles=[],riseH=130,perspectiveFactor=.04;function setup(){createCanvas(windowWidth,windowHeight),wisW=width,wisH=height,doorContent=createGraphics(wisW,wisH),initStratus(),noLoop()}function draw(){background(220),drawStratus(doorContent,16),initRise(),image(doorContent,0,0)}function initStratus(){for(let t=0;t<55;t++){let t=random(50,width-50),e=height/random(3,5)+random(-120,80),r=random(5,60);stratusCircles.push({x:t,y:e,r})}}function drawStratus(t,e){let r=e,n=[];for(let e=0;e<t.width;e+=r){n[e/r]=[];for(let i=0;i<t.height;i+=r)n[e/r][i/r]=densityAtPoint(e,i)}t.drawingContext.setLineDash([4,2,1,3,5]);for(let e=0;e<n.length-1;e++)for(let i=0;i<n[e].length-1;i++){let o=createVector(e*r,i*r),s=createVector((e+1)*r,i*r),a=createVector((e+1)*r,(i+1)*r),c=createVector(e*r,(i+1)*r),d=.05;drawContour(t,[n[e][i]>d,n[e+1][i]>d,n[e+1][i+1]>d,n[e][i+1]>d],o,s,a,c)}t.drawingContext.setLineDash([])}function densityAtPoint(t,e){let r=0;for(let n of stratusCircles){let i=dist(t,e,n.x,n.y);r+=exp(-.02*pow(i-n.r,2))}return r}function drawContour(t,e,r,n,i,o){if(e[0]===e[1]&&e[1]===e[2]&&e[2]===e[3])return;let s=[r,n,i,o];for(let r=0;r<s.length;r++)if(e[r]!==e[(r+1)%4]){let e=s[r],n=s[(r+1)%4],i=createVector((e.x+n.x)/2,(e.y+n.y)/2);t.line(e.x,e.y,i.x,i.y)}}function initRise(){for(let t=0;t<10;t++){let e=createRise(doorContent,doorContent.height/2+t*riseH/2,t);drawRise(doorContent,e)}}function createRise(t,e,r){let n=[],i=riseH*random(.15,.55),o=TWO_PI/wisW;for(let s=0;s<wisW;s+=1){let a=(wisW/2-s)*perspectiveFactor*r,c=noise(.003*s,.005*e)*riseH,d=i*sin(o*s),l=t.createVector(s,e+c+d+a);n.push(l)}return n}function drawRise(t,e){for(let r=0;r<8;r++){let n=riseH/8*r,i=map(r,0,7,0,15);t.drawingContext.setLineDash([i,i]),t.fill(0,0,190,10),t.noFill(),t.beginShape();for(let r of e)t.vertex(r.x,r.y+n);t.endShape()}t.drawingContext.setLineDash([])}